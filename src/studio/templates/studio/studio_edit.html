{% extends "admin/base_site.html" %}

{% block breadcrumbs %}{% endblock %}
{% block content %}
<!--<script type="text/javascript" src="http://apps.bdimg.com/libs/vue/1.0.14/vue.min.js"></script>-->
<script type="text/javascript" src="http://apps.bdimg.com/libs/vue/1.0.14/vue.js"></script>

<script type="text/javascript">
	Vue.config.debug = true
	Vue.component('file-loader',{
		template:"<input model='filebody' type='file' @change='changed'>",
		props:{
			upload_url:{
				type: String,
      			required: true
			},
			url:{
				type: String,
				twoWay:true
			},
			ready:{},
			},
		methods:{
			changed:function (changeEvent) {
				file=changeEvent.target.files[0]
				this.fd = new FormData();
				this.fd.append('file', file)
				this.ready=true
				alert(file)
			},
			upload:function () {
				var self =this
				$.ajax({
					//'/studio/upload/logo/?studio=name'
					url:this.upload_url,
					type:'post',
					data:this.fd,
					contentType: false,
					cache: false,
					success:function (data) {
						alert(data)
						self.url=data.url
						//self.$emit('url.changed',data.url)
					},
					processData:false,
				})
				
			}
		}
	})
	//<button @click='upload'>upload</button><img v-show='url' :src='url' >
</script>




<!--------------------main-fram---------------------------------->
<script type="text/javascript">
	
	studio={{studio | safe}}
	//{
	//	pk:'{{studio.pk}}'
	//	name:'{{studio.name}}',
	//	logo:'{{studio.logo}}',
	//}
	

	Vue.config.delimiters = ['[[', ']]']

	Vue.component('second-page',{template:'#second-page'})
	errors={}
	$(function () {
		var t=new Vue({
			el:'#vue_content',
			data:{
				studio:studio,
				face_page:'first-page',
				errors:errors,
			},
			methods:{
				save:function () {
					alert('wahaha')
					var self=this;
					var post_data={
						save_studio:{studio:studio}
					}
					$.post('',JSON.stringify(post_data),function (data) {
						alert(data)
						t.$refs.fp.update_errors(data.save_studio.errors)
						//for(k in data.save_studio.errors){
						//	Vue.set(errors,k,data.save_studio.errors[k])
						//}
						//this.errors=data.save_studio.errors
						//t.$refs.fp.$set('errors',data.save_studio.errors)
						//Vue.set(window,'errors',)
					})
				}
			}
		})
	})
</script>

<div id='vue_content'>
	<div id='logo_div'>
		<h1 v-text='studio.name'></h1>
	</div>
	
	<ul class='menu'>
		<li @click="face_page='first-page'" 
			:class="{'active':face_page=='first-page'}">Studio Infomation</li>
		<li @click="face_page='second-page'" 
			:class="{'active':face_page=='second-page'}">Apps</li>
	</ul>

	<button name="test" type="button" value="val" @click="save()">Save</button>

	<first-page v-show='face_page=="first-page"' v-ref:fp ></first-page>
	<second-page v-show='face_page=="second-page"'></second-page>

</div>


<!------------------------first-page------------------>
<script for='first-page' type="text/javascript" >
	fields=[
		{name:'logo',type:'logo',label:'Logo'},
		{name:'link_ios',type:'text',label:'Link IOS'},
		{name:'link_gp',type:'text',label:'Link GooglePlay'},
		{name:'link_face',type:'text',label:'Link FaceBook'},
		{name:'link_twit',type:'text',label:'Link Twitter'},
		{name:'dsp',type:'area',label:'description'},
	]
	
	Vue.component('field',{
		template:'#field',
		props:['name'],
		data:function () {
			return {
				fields:fields,
				studio:studio,
				errors:this.$parent.errors,
			}
		},
		beforeCompile:function () {
			for(i in fields){
				if(fields[i].name==this.name){
					this.item=fields[i]
					break
				}
			}
		},
		components:{
			text:{
				props:['name'],
				template:'<input type="text">'
			},
			area:{
				props:['name'],
				template:'<textarea rows="10" cols="10" ></textarea>'
			}
		},
		methods:{
			error_data:function (name) {
				if(this.errors[name]){
					return this.errors[name]
				}else{
					return 'ss'
				}
			}
		}
		
	})
	var page1=Vue.component('first-page',{
		template:'#first-page',
		data:function () {
			return {
				studio:studio,
				errors:errors,
			}
		},
		props:['editable',],
		methods:{
			mock:function () {
				Vue.set(errors,'link_gp',['erro is error','jj yy'])
			},
			update_errors:function (errors) {
				for(k in errors){
					Vue.set(this.errors,k,errors[k])
					//this.$set('errors')
				}
			}
		}

	})
</script>

<template id='first-page'>

	<div>
		<button name="test" type="button" value="val" @click='mock()'>Button Text</button>
		<div>
			<label for="id_for_logo">Logo</label>
			<file-loader id='id_for_logo' 
				accept='image/gif, image/jpeg,image/png' 
				v-ref:logo 
				upload_url='/studio/upload/logo/?studio=name' 
				:url.sync='studio.logo'>
			</file-loader>
			<button @click='$refs.logo.upload()' :disabled='!$refs.logo.ready'>Upload Logo Image</button>
			<img :src="studio.logo" alt="" v-if='studio.logo'>
		</div>

		
		<div class='_row'>
			<h2 class='row-title'>Base Info</h2>
			<div class='cell'>
			</div>
		</div>

		
		<div class='_row'>
			<h2 class='row-title'>Link</h2>
			<div class='cell'>
				<field name='link_ios'></field>
				<field name='link_gp'></field>
				<field name='link_face'></field>
				<field name='link_twit'></field>
			</div>
			<div class='cell'>
				<field name='dsp'></field>
			</div>
		</div>
	</div>
	
</template>

<template id='field'>
	<div class="fieldWrapper">
	    <label for="[['id_'+name]]">[[item.label]]</label>
	    <component :is='item.type' 
	    	v-model='studio[name]' 
	    	:name='name' 
	    	id="[['id_'+name]]"></component> 
		<span v-text='error_data(name)' class='error'></span>
	    <slot>
	    </slot>
	    
	</div>
</template>

<!------------------second-page---------------------->
<template id='second-page'>
	<div>
		this is second-page
	</div>
</template>

<!-------------------over----------------------------->
<style type="text/css" media="screen" id="test">
	#logo_div{
		width:200px;
		height:100px;
		border: 1px solid #999;
	}
	.menu li{
		display: inline-block;
		padding: 20px;
	}
	.menu .active{
		border-bottom: 1px solid red;
	}
	.fieldWrapper input,.fieldWrapper textarea{
		width:90%;
	}
	.fieldWrapper input{
		height:30px;
	}
	.cell{
		vertical-align: top;
		width:45%;
		display: inline-block;
	}
	.row-title{
		margin-top:30px;
		margin-bottom:30px;
		
	}
</style>


{% endblock %}